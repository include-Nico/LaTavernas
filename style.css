/* --- REGOLE BASE --- */
* { 
    box-sizing: border-box; 
    user-select: none; 
    font-family: sans-serif;
}

body { 
    margin: 0; 
    overflow: hidden; 
    background: #111; 
    color: white; 
    height: 100dvh; 
    width: 100vw; 
}

/* BLOCCA IL TOCCO SOLO SUL GIOCO (Permette lo scroll nei menu) */
canvas { 
    display: block; 
    touch-action: none; 
}

/* --- MENU SCHERMO INTERO --- */
.fullscreen-menu {
    position: fixed; top: 0; left: 0; width: 100vw; height: 100dvh;
    background: linear-gradient(to bottom, #1a1a2e, #000000);
    z-index: 100;
    overflow-y: auto; 
    -webkit-overflow-scrolling: touch; 
    touch-action: auto; 
    display: flex; flex-direction: column; align-items: center; 
    padding: 40px 10px;
}

#main-menu, #game-over-screen { justify-content: center; }
#character-select, #equipment-select { justify-content: flex-start; }

.game-title { 
    font-size: clamp(40px, 8vw, 80px); color: #00ffff; text-shadow: 0 0 20px #00ffff; 
    margin-top: 0; margin-bottom: 20px; text-align: center; line-height: 1.1; 
}

#player-name-input {
    background: #222; border: 3px solid #00ffff; color: #fff; font-size: 24px; font-weight: bold;
    padding: 15px; margin-bottom: 25px; border-radius: 15px; text-align: center;
    width: 320px; max-width: 90vw; outline: none; transition: 0.3s; box-shadow: 0 0 15px rgba(0,255,255,0.2);
    flex-shrink: 0;
}
#player-name-input:focus { background: #333; box-shadow: 0 0 25px rgba(0,255,255,0.8); }

.menu-btn {
    background: linear-gradient(145deg, #0088cc, #005599); border: 3px solid #00ffff; color: white;
    font-size: 22px; font-weight: bold; padding: 15px 30px; margin: 10px; border-radius: 15px;
    cursor: pointer; transition: 0.2s; box-shadow: 0 5px 15px rgba(0, 255, 255, 0.3); width: 320px; max-width: 90vw; white-space: nowrap; flex-shrink: 0;
}
.menu-btn:hover { transform: translateY(-5px); box-shadow: 0 10px 25px rgba(0, 255, 255, 0.6); filter: brightness(1.2); }
.settings-btn { background: linear-gradient(145deg, #8800cc, #550099); border-color: #ff00ff; box-shadow: 0 5px 15px rgba(255, 0, 255, 0.3); }

/* Ingranaggio Codice Segreto */
.settings-gear {
    position: fixed; top: 15px; right: 15px;
    background: rgba(0,0,0,0.8); border: 2px solid #00ffff; color: white;
    font-size: 28px; border-radius: 50%; width: 55px; height: 55px;
    cursor: pointer; z-index: 1000; transition: 0.3s; box-shadow: 0 0 15px #00ffff;
    display: flex; justify-content: center; align-items: center; padding: 0;
}
.settings-gear:hover { transform: rotate(90deg) scale(1.1); background: #222; }

#cheat-input {
    background: #111; border: 3px solid #ff00ff; color: #fff; font-size: 20px; font-weight: bold;
    padding: 15px; margin-bottom: 20px; border-radius: 10px; text-align: center; width: 100%; outline: none;
}

/* --- CARTE PERSONAGGI E EQUIPAGGIAMENTO --- */
.char-container { 
    display: flex; gap: 20px; margin-top: 10px; margin-bottom: 30px; 
    flex-wrap: wrap; justify-content: center; width: 100%; max-width: 900px; 
}
.char-card { background: #222; border: 4px solid #555; border-radius: 15px; padding: 20px; width: 220px; text-align: center; transition: 0.3s; cursor: pointer; position: relative; }
.char-card:hover { border-color: #00ffff; transform: scale(1.05); }
.char-card.locked { opacity: 0.5; filter: grayscale(100%); cursor: not-allowed; }
.char-card.locked:hover { transform: none; border-color: #555; }
.char-card.selected { border-color: #00ff00; box-shadow: 0 0 20px #00ff00; }
.lock-icon { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 60px; text-shadow: 0 0 10px #000; }
.char-weapons-list { font-size: 16px; color: #00ffff; margin: 15px 0; min-height: 60px; display: flex; flex-direction: column; justify-content: center;}

.equip-section { width: 100%; display: flex; flex-direction: column; align-items: center; }
.equip-category-title { color: #fff; margin-top: 20px; margin-bottom: 10px; text-shadow: 0 0 5px #fff; border-bottom: 2px solid #555; padding-bottom: 5px; width: 80%; text-align: center;}
.equip-btn { margin-top: 15px; background: #0088cc; color: white; border: none; padding: 10px; border-radius: 8px; width: 100%; font-weight: bold; font-size: 16px; cursor: pointer; }
.equip-btn:disabled { background: #444; color: #888; cursor: not-allowed; }
.equip-btn.buy { background: #bf00ff; }
.equip-btn.equip { background: #00aa00; }
.equip-btn.equipped { background: #555; border: 2px solid #00ff00; color: #00ff00; }

/* --- UI GIOCO --- */
#ui { position: absolute; top: 20px; left: 20px; z-index: 10; display: flex; flex-direction: column; gap: 15px; font-size: 20px; text-shadow: 2px 2px 0 #000; pointer-events: none; }
.top-row { display: flex; align-items: center; gap: 20px; }
.bars-container { display: flex; flex-direction: column; gap: 5px; }
.bar-row { display: flex; align-items: center; }
.bar-icon { font-size: 24px; margin-right: 8px; width: 30px; text-align: center; }

.hp-bar-bg { width: 150px; height: 20px; background: #333; border: 3px solid #000; border-radius: 12px; overflow: hidden; box-shadow: 0 0 10px rgba(0,0,0,0.5); pointer-events: auto; }
#hp-bar-fill { height: 100%; background: linear-gradient(to bottom, #ff3030, #cc0000); width: 100%; transition: width 0.2s; border-radius: 10px; }

#shield-ui { display: none; }
.shield-bar-bg { width: 150px; height: 16px; background: #222; border: 2px solid #000; border-radius: 8px; overflow: hidden; box-shadow: 0 0 10px rgba(0,100,255,0.4); pointer-events: auto; }
#shield-bar-fill { height: 100%; background: linear-gradient(to bottom, #00d4ff, #0055ff); width: 100%; transition: width 0.2s; border-radius: 8px; }

#weapons-ui { display: flex; gap: 10px; font-size: 18px; background: rgba(0,0,0,0.7); padding: 5px 10px; border-radius: 10px; border: 2px solid #555; width: fit-content; pointer-events: auto; }
.weapon-slot { display: flex; align-items: center; gap: 5px; color: #ccc; }
.weapon-lvl { font-size: 14px; color: #00ffff; font-weight: bold; }

#pause-btn {
    position: absolute; top: 20px; right: 20px; z-index: 1000; pointer-events: auto;
    background: rgba(0, 0, 0, 0.8); border: 3px solid #00ffff; color: white;
    font-size: 28px; font-weight:900; border-radius: 15px; padding: 10px 20px; cursor: pointer; box-shadow: 0 0 15px #00ffff;
    transition: transform 0.1s;
}
#pause-btn:active { transform: scale(0.9); background: #333; }

#xp-bar-container { position: absolute; bottom: 0; left: 0; width: 100%; height: 15px; background: #222; z-index: 10; pointer-events: none;}
#xp-bar { height: 100%; background: #00ffff; width: 0%; transition: width 0.2s; box-shadow: 0 0 10px #00ffff;}

/* --- NUOVO JOYSTICK MOBILE FLUTTUANTE --- */
#joystick-zone {
    position: absolute; top: 0; left: 0; width: 100vw; height: 100dvh; 
    z-index: 50; touch-action: none;
    /* La zona prende tutto lo schermo ma non ha sfondi visibili */
}
#joystick-base { 
    width: 140px; height: 140px; background: rgba(255, 255, 255, 0.1); 
    border: 3px solid rgba(255, 255, 255, 0.4); border-radius: 50%; 
    position: absolute; display: none; /* Appare e si sposta al tocco */
    transform: translate(-50%, -50%); /* Centra perfettamente sul dito */
    box-shadow: 0 0 20px rgba(0,255,255,0.2); pointer-events: none;
}
#joystick-stick { 
    width: 70px; height: 70px; background: rgba(0, 255, 255, 0.7); 
    border-radius: 50%; position: absolute; top: 50%; left: 50%; 
    transform: translate(-50%, -50%); box-shadow: 0 0 15px #00ffff; pointer-events: none; 
}

/* --- MODALI POP-UP IN GIOCO --- */
.modal {
    display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
    background: linear-gradient(to bottom, #2a2a2a, #1a1a1a); padding: 30px; border: 4px solid #555; text-align: center; 
    border-radius: 15px; z-index: 200; width: 90%; max-width: 450px; box-shadow: 0 10px 40px rgba(0,0,0,0.8);
    touch-action: auto;
}
.upgrade-btn {
    display: flex; flex-direction: column; justify-content: center; align-items: center; gap: 5px; 
    width: 100%; margin: 10px 0; padding: 15px; background: linear-gradient(145deg, #3d3d3d, #2b2b2b); border: 2px solid #444; color: white; cursor: pointer; border-radius: 10px; transition: all 0.2s;
}
.upgrade-btn:hover { background: linear-gradient(145deg, #4d4d4d, #3b3b3b); border-color: #00ffff; transform: translateY(-3px); }
.upgrade-btn.boss-btn:hover { border-color: #ffd700; box-shadow: 0 6px 15px rgba(255, 215, 0, 0.4); } 
.upgrade-title { font-size: 20px; font-weight: bold; color: #fff; text-align: center; }
.upgrade-desc { font-size: 14px; color: #bbb; text-align: center; }

.item-feedback { position: absolute; font-size: 35px; font-weight: bold; animation: floatUp 1.5s forwards; z-index: 15; text-shadow: 2px 2px 4px #000; text-align: center; pointer-events: none;}
@keyframes floatUp { 0% { opacity: 1; transform: translateY(0) scale(1); } 100% { opacity: 0; transform: translateY(-80px) scale(1.1); } }

/* --- OTTIMIZZAZIONI TELEFONI --- */
@media (max-width: 768px) {
    .fullscreen-menu { padding: 30px 10px; }
    .game-title { font-size: 45px; margin-bottom: 20px; }
    #player-name-input { font-size: 20px; padding: 12px; margin-bottom: 15px; }
    .menu-btn { font-size: 16px; padding: 12px 10px; width: 280px; max-width: 90vw; margin: 6px; border-width: 2px; }
    
    .char-container { gap: 10px; padding: 5px; }
    .char-card { width: 140px; padding: 10px; }
    .char-card h3 { font-size: 16px; margin: 5px 0; }
    
    #ui { top: 10px; left: 10px; gap: 8px; font-size: 16px; }
    .top-row { gap: 10px; }
    .hp-bar-bg, .shield-bar-bg { width: 120px; height: 18px; } 
    .bar-icon { font-size: 18px; width: 20px; }
    #weapons-ui { gap: 8px; font-size: 14px; padding: 5px; }
    .weapon-slot { gap: 3px; }
    #pause-btn { top: 15px; right: 15px; padding: 10px 18px; font-size: 24px; border-width: 2px; }
    
    .modal { padding: 15px; width: 95%; max-height: 90dvh; overflow-y: auto; }
    .upgrade-btn { padding: 10px; margin: 8px 0; }
}
